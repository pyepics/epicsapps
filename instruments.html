
<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Epics Instruments &#8212; Epics Applications Using PyEpics</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="_static/bizstyle.css?v=5283bb3d" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    
    <script src="_static/documentation_options.js?v=9986cd63"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/bizstyle.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="PV Logger" href="pvlogger.html" />
    <link rel="prev" title="Area Detector Display" href="ad_display.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <!--[if lt IE 9]>
    <script src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head><body>
    <div style="background-color: #E4EAED; text-align: left; padding:
                0px 0px 5px 5px">
      </div>

    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="pvlogger.html" title="PV Logger"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="ad_display.html" title="Area Detector Display"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">EpicsApps</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Epics Instruments</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="epics-instruments">
<span id="instruments"></span><h1>Epics Instruments<a class="headerlink" href="#epics-instruments" title="Link to this heading">¶</a></h1>
<p>Epics Instruments is a GUI application (using wxPython) that lets any user:</p>
<blockquote>
<div><ul class="simple">
<li><p>Organize PVs into Instruments: a named collection of PVs</p></li>
<li><p>Manage Instruments with Notebook or tabbed interface.</p></li>
<li><p>Save Positions for any Instrument by name.</p></li>
<li><p>Restore Positions for any Instrument by name.</p></li>
<li><p>Remember Settings for all definitions into a single file that can be loaded later.</p></li>
<li><p>Multiple Users can be using multiple instrument files at any one time.</p></li>
</ul>
</div></blockquote>
<p>It was originally written to replace and organize the multitude of similar MEDM
screens that appear at many workstations using Epics.</p>
<section id="running-epics-instruments">
<h2>Running Epics Instruments<a class="headerlink" href="#running-epics-instruments" title="Link to this heading">¶</a></h2>
<p>To run Epics Instruments, use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">epicsapps</span> <span class="n">instruments</span>
</pre></div>
</div>
<p>or click on the icon.</p>
<p>A small window to select an Epics Instrument File, like this</p>
<a class="reference internal image-reference" href="_images/Inst_Startup.png"><img alt="_images/Inst_Startup.png" src="_images/Inst_Startup.png" style="width: 80%;" />
</a>
<p>If this is your first time using the application, choose a name, and hit return
to start a new Instrument File.  The next time you run Epics Instruments, it
should remember which files you have recently used, and present you with a
drop-down list of Instrument Files.  Since all the definitions, positions, and
settings are saved in a single file, restoring this file will recall the
earlier session of instrument definitions and saved positions.</p>
<p>An Epics <strong>Instrument</strong> is a collection of PVs.  Each Instrument will also
have a collection of <strong>Positions</strong>, which are just the locations of all the
PVs in the instrument at the time the Position was saved.  Like a PV, each
Instrument and each Position for an Instrument has a unique name.</p>
</section>
<section id="defining-a-new-instrument">
<h2>Defining a New Instrument<a class="headerlink" href="#defining-a-new-instrument" title="Link to this heading">¶</a></h2>
<p>To define a new Instrument, select <strong>Create New Instrument</strong> from the
Instruments Menu.  A screen will appear in which you can name the
instrument and the PVs that belong to the Instrument.</p>
<p>If you add a few PVs and click OK, the PVs will connect, and you will see a
screen something like this</p>
<a class="reference internal image-reference" href="_images/InstMain_Stage.png"><img alt="_images/InstMain_Stage.png" src="_images/InstMain_Stage.png" style="width: 95%;" />
</a>
</section>
<section id="editing-an-exisiting-instrument">
<h2>Editing an Exisiting Instrument<a class="headerlink" href="#editing-an-exisiting-instrument" title="Link to this heading">¶</a></h2>
<a class="reference internal image-reference" href="_images/Inst_Edit.png"><img alt="_images/Inst_Edit.png" src="_images/Inst_Edit.png" style="width: 50%;" />
</a>
</section>
<section id="the-instrument-file">
<h2>The Instrument File<a class="headerlink" href="#the-instrument-file" title="Link to this heading">¶</a></h2>
<p>All the information for definitions of your Instruments and their Positions
are saved in a single file – the Instruments file, with a default
extension of ‘.ein’ (Epics INstruments).   You can use many different
Instrument Files for different domains of use.</p>
<p>The Instrument File is an SQLite database file, and can be browsed and
manipulated with external tools.  Of course, this can be a very efficient
way of corrupting the data, so do this with caution.  A further note of
caution is to avoid having a single Instrument file open by multiple
applications – this can also cause corruption.  The Instrument files can
be moved around and copied without problems.</p>
</section>
<section id="accessing-instruments-and-positions-with-epics">
<h2>Accessing Instruments and Positions with Epics<a class="headerlink" href="#accessing-instruments-and-positions-with-epics" title="Link to this heading">¶</a></h2>
<p>You may want to be able to access Instrument and Positions from outside the
Instruments application.  For example, you may want to define an Instrument for
“Detector Stages”, and save positions called “In” and “Out”.  It would be
helpful if you could move the detector to “In” or “Out” from Epics Channel
Access, either from a script or a data collection application.</p>
<p>Instruments can be set up to respond to Channel Access puts and move an
Instrument to a Position.  To do this, use <a class="reference external" href="https://raw.githubusercontent.com/pyepics/epicsapps/refs/heads/master/examples/instruments/epics_client/PyInstrument.db">PyInstrument.db</a>, and load that
into an Epics IOC with a command like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dbLoadRecords</span><span class="p">(</span><span class="s2">&quot;PyInstrument.db&quot;</span><span class="p">,</span><span class="s2">&quot;P=13XRM:, Q=Inst&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>From the Instruments app, you can go to the Options-&gt;General Settings menu, to
see a screen like</p>
<a class="reference internal image-reference" href="_images/Inst_Conf.png"><img alt="_images/Inst_Conf.png" src="_images/Inst_Conf.png" style="width: 60%;" />
</a>
<p>Checking the “Use Epics Db” box and entering the Prefix defined with the
<cite>dbLoadRecords</cite> command will then enable the Instruments program to respond to
Channel Access requests to move Instruments to Positions.</p>
<p>Using the <a class="reference external" href="https://raw.githubusercontent.com/pyepics/epicsapps/refs/heads/master/examples/instruments/epics_client/PyInstrument.adl">PyInstrument.adl</a> display file and an MEDM command like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">medm</span> <span class="o">-</span><span class="n">x</span> <span class="o">-</span><span class="n">macro</span> <span class="s2">&quot;P=13XRM:,Q=Inst&quot;</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">epics</span><span class="o">/</span><span class="n">adl</span><span class="o">/</span><span class="nb">all</span><span class="o">/</span><span class="n">PyInstruments</span><span class="o">.</span><span class="n">adl</span>
</pre></div>
</div>
<p>will then bring up a display screen like this</p>
<a class="reference internal image-reference" href="_images/Inst_PyInst.png"><img alt="_images/Inst_PyInst.png" src="_images/Inst_PyInst.png" style="width: 60%;" />
</a>
<p>where you can enter the name of an Instrument, enter the name of a Position,
and hit the Move button to move to that position. Several Epics PVs listed in
the table below are used for this communication.  Note that the Instruments App
itself must be running in order for these moves to happen.</p>
<p id="instruments-pv-table"><strong>Table of CA interface to Instruments</strong> These PVs will be used for the CA
interface to Epics Instruments.</p>
<blockquote>
<div><table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>PV Name</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>$(P)$(Q):InstName</p></td>
<td><p>Instrument Name</p></td>
</tr>
<tr class="row-odd"><td><p>$(P)$(Q):PosName</p></td>
<td><p>Position Name</p></td>
</tr>
<tr class="row-even"><td><p>$(P)$(Q):InstOK</p></td>
<td><p>Flag for Instrument Name is valid</p></td>
</tr>
<tr class="row-odd"><td><p>$(P)$(Q):PosOK</p></td>
<td><p>Flag for Position Name is valid</p></td>
</tr>
<tr class="row-even"><td><p>$(P)$(Q):Move</p></td>
<td><p>Command to Move</p></td>
</tr>
<tr class="row-odd"><td><p>$(P)$(Q):Message</p></td>
<td><p>Runtime message</p></td>
</tr>
<tr class="row-even"><td><p>$(P)$(Q):TSTAMP</p></td>
<td><p>timestamp, showing Instrument is connected.</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>From pyepics, you could also do a move with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">epics</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_pv</span><span class="p">,</span> <span class="n">poll</span>
<span class="n">prefix</span> <span class="o">=</span> <span class="s1">&#39;13XRM:Inst:&#39;</span>
<span class="n">move_pv</span> <span class="o">=</span> <span class="n">get_pv</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s1">Move&#39;</span><span class="p">)</span>
<span class="n">iname_pv</span> <span class="o">=</span> <span class="n">get_pv</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s1">InstName&#39;</span><span class="p">)</span>
<span class="n">pname_pv</span> <span class="o">=</span> <span class="n">get_pv</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s1">PosName&#39;</span><span class="p">)</span>
<span class="n">iok_pv</span> <span class="o">=</span> <span class="n">get_pv</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s1">InstOK)</span>
<span class="n">pok_pv</span> <span class="o">=</span> <span class="n">get_pv</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s1">PosOK&#39;</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">move_instrument</span><span class="p">(</span><span class="n">instrument</span><span class="p">,</span> <span class="n">position</span><span class="p">):</span>
    <span class="n">iname_pv</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">instname</span><span class="p">)</span>
    <span class="n">pname_pv</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">posname</span><span class="p">)</span>
    <span class="n">poll</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">iok_pv</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not find instrument &#39;</span><span class="si">{</span><span class="n">instname</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">pok_pv</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not find position &#39;</span><span class="si">{</span><span class="n">posname</span><span class="si">}</span><span class="s2">&#39; for &#39;</span><span class="si">{</span><span class="n">instname</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">move_pv</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">move_instrument</span><span class="p">(</span><span class="s1">&#39;SampleStage&#39;</span><span class="p">,</span> <span class="s1">&#39;Sample 1&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="using-postgresql-and-epicsscan">
<h2>Using PostgresQL and epicsscan<a class="headerlink" href="#using-postgresql-and-epicsscan" title="Link to this heading">¶</a></h2>
<p>If you are using the EpicsScan application for data collection, you can also
use its Postgres database as an Epics Instruments database.  This requires a
bit more setup, but allows mulitple client programs to access and use the
Instruments at the same time.</p>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Epics Instruments</a><ul>
<li><a class="reference internal" href="#running-epics-instruments">Running Epics Instruments</a></li>
<li><a class="reference internal" href="#defining-a-new-instrument">Defining a New Instrument</a></li>
<li><a class="reference internal" href="#editing-an-exisiting-instrument">Editing an Exisiting Instrument</a></li>
<li><a class="reference internal" href="#the-instrument-file">The Instrument File</a></li>
<li><a class="reference internal" href="#accessing-instruments-and-positions-with-epics">Accessing Instruments and Positions with Epics</a></li>
<li><a class="reference internal" href="#using-postgresql-and-epicsscan">Using PostgresQL and epicsscan</a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="ad_display.html"
                          title="previous chapter">Area Detector Display</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="pvlogger.html"
                          title="next chapter">PV Logger</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/instruments.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="pvlogger.html" title="PV Logger"
             >next</a> |</li>
        <li class="right" >
          <a href="ad_display.html" title="Area Detector Display"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">EpicsApps</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Epics Instruments</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright 2025, Matthew Newville, The University of Chicago.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.2.3.
    </div>
  </body>
</html>